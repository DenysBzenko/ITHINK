import speech_recognition as sr
import pyttsx3


def recognize_speech():
    r = sr.Recognizer()
    with sr.Microphone() as source:
        print("Скажіть щось...")
        audio = r.listen(source)
        try:
            text = r.recognize_google(audio, language="uk-UA")
            print("Ви сказали: ", text)
            return text.lower()
        except sr.UnknownValueError:
            print("Не вдалося розпізнати голос.")
        except sr.RequestError as e:
            print(f"Помилка сервісу: {e}")


def speak_text(text):
    engine = pyttsx3.init()
    engine.say(text)
    engine.runAndWait()


def dialog_flow(user_input):
    # Ключові слова для позитивної відповіді
    positive_keywords = [
        "не надо блокировать", "согласен", "да", "конечно", "буду пользоваться",
        "не блокируйте", "продлевать", "продлевайте", "нет планирую",
        "не пользуюсь", "хорошо", "планирую", "планируем", "буду пользоваться дальше",
        "планируется", "он мне нужен"
    ]

    # Ключові слова для негативної відповіді - більше інформації
    more_info_keywords = [
        "не хочу торопиться с решением", "больше узнать", "больше информации", "разъясните",
        "объясните", "уточните", "расскажите подробнее", "хотелось бы понять", "нужна дополнительная информация",
        "не спешу с выбором", "можно больше деталей", "хочу разобраться", "какие есть варианты",
        "дайте полную информацию", "объясните по пунктам", "как это работает", "что нужно учитывать",
        "дайте рекомендации", "хочу подумать", "дайте время подумать", "могу обсудить позже",
        "надо подумать над решением", "какой договор", "какое продление"
    ]

    # Ключові слова для "Чому не отримав попередження"
    no_notification_keywords = [
        "проинформирован заранее", "проинформирован", "уведомление", "уведомить", "смска",
        "смс", "не сообщили", "предупреждать", "не предупредили", "не было информации", "оповещение",
        "как узнать заранее", "где уведомление", "мне не сообщили", "предупреждение", "сообщите заранее",
        "можно ли получить уведомление", "хочу получить информацию", "как уведомить", "когда будет сообщение",
        "есть ли способ уведомить"
    ]

    # Ключові слова для "Я сама поїду в відділення"
    visit_office_keywords = [
        "я поеду в отделение", "надо ехать в отделение", "я заеду к вам", "я приеду к вам", "я поеду к вам",
        "в отделение", "собираюсь посетить отделение", "планирую приехать", "хочу заехать", "мне нужно в отделение",
        "когда могу приехать", "когда открыто отделение", "какие часы работы", "как доехать до отделения",
        "адрес отделения",
        "можно ли приехать", "я на пути к вам", "нужно зайти в отделение", "как долго там буду",
        "могу ли записаться на время",
        "есть ли очередь", "какие документы взять", "нужна ли предварительная запись"
    ]

    # Ключові слова для "Практично не користуюсь"
    no_use_keywords = [
        "не пользуюсь", "номер не актуальный", "не нуждаюсь", "это не нужно", "больше не использую",
        "устаревший номер", "номер не верный", "не могу использовать", "не подходит", "не актуально",
        "это не работает", "больше не требуется", "не собираюсь пользоваться", "номер недоступен",
        "это не полезно", "это лишнее", "не планирую использовать"
    ]

    # Перевірка на позитивну відповідь
    if any(keyword in user_input for keyword in positive_keywords):
        speak_text(
            "Благодарю за выбор нашей компании, но сложилась такая ситуация, ранее Ваш договор автоматически "
            "ежегодно продлевался еще на год, если вы стабильно пополняли свою сим-карту и пользовались тарифным планом. "
            "Увы, Сейчас данная программа не работает, по этому необходимо единоразово пройти процедуру пролонгации, "
            "эта процедура полностью бесплатная и условия у вас остаются без изменений. Сейчас подключу вас на старшего менеджера для процедуры."
        )
        return "Передача менеджеру"

    # Перевірка на більше інформації
    elif any(keyword in user_input for keyword in more_info_keywords):
        speak_text(
            "Для того чтобы принять решение, могу рассказать вам подробнее о текущих условиях, или же передать вас на старшего менеджера для консультации."
        )
        return "Запит додаткової інформації"

    # Перевірка на відсутність попередження
    elif any(keyword in user_input for keyword in no_notification_keywords):
        speak_text(
            "Извините за неудобства. Мы должны были отправить уведомление заранее. Сейчас могу предоставить всю информацию и помочь с решением."
        )
        return "Запит на попередження"

    # Перевірка на поїздку у відділення
    elif any(keyword in user_input for keyword in visit_office_keywords):
        speak_text(
            "Вы можете посетить ближайшее отделение для решения вашего вопроса. Хотите узнать адрес или график работы ближайшего офиса?"
        )
        return "Запит про візит до відділення"

    # Перевірка на невикористання номера
    elif any(keyword in user_input for keyword in no_use_keywords):
        speak_text(
            "Если вы не пользуетесь номером, могу помочь вам деактивировать услугу или предложить варианты на ваше усмотрение."
        )
        return "Запит про невикористання номера"

    # Якщо не відповідає жодному з сценаріїв
    else:
        speak_text("Дякую за ваші відповіді. Якщо буде потрібно, можу передати вас на менеджера.")
        return "Невідома відповідь"


def main():
    # Привітання та основне питання
    speak_text("А")

    # Отримання відповіді від користувача
    user_input = recognize_speech()

    if user_input:
        result = dialog_flow(user_input)
        print("Результат: ", result)


if __name__ == "__main__":
    main()
